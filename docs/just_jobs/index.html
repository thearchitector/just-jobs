<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>just_jobs API documentation</title>
<meta name="description" content="Python package `just_jobs` provides a lightweight asynchronous Python job executor.
Using Redis by default (but not exclusivly, via custom `Broker`s), …" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
<style>.homelink{display:block;font-size:2em;font-weight:bold;color:#555;padding-bottom:0.5em;border-bottom:1px solid silver}.homelink:hover{color:inherit}.homelink img{width:100px;height:100px;margin:auto;margin-bottom:0.3em}</style>
<link rel="canonical" href="https://thearchitector.github.io/just-jobs/just_jobs">
<link rel="icon" href="https://thearchitector.github.io/just-jobs/logo.png">
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Package <code>just_jobs</code></h1>
</header>
<section id="section-intro">
<p>Python package <code><a title="just_jobs" href="#just_jobs">just_jobs</a></code> provides a lightweight asynchronous Python job executor.
Using Redis by default (but not exclusivly, via custom <code><a title="just_jobs.Broker" href="#just_jobs.Broker">Broker</a></code>s), it is a smaller and
production-ready alternative to Celery for applications where distributed microservices
are overkill.</p>
<h2 id="what-is-a-job">What is a "job"?</h2>
<p>A job is any exposed function, asynchronous coroutine, or generic callable that has
been queued to a worker for delayed execution by calling <code><a title="just_jobs.Manager.enqueue" href="#just_jobs.Manager.enqueue">Manager.enqueue()</a></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>"Exposed" means the callable must be importable through a module-reference FQN
string, such as "just_jobs.Manager.enqueue". This is due to a limitation with Python
<a href="https://docs.python.org/3/library/pickle.html">pickling</a>.</p>
</div>
</section>
<section>
<h2 class="section-title" id="header-submodules">Sub-modules</h2>
<dl>
<dt><code class="name"><a title="just_jobs.brokers" href="brokers/index.html">just_jobs.brokers</a></code></dt>
<dd>
<div class="desc"><p>Base and reference implementations for <code><a title="just_jobs.Broker" href="#just_jobs.Broker">Broker</a></code> classes.</p></div>
</dd>
<dt><code class="name"><a title="just_jobs.errors" href="errors.html">just_jobs.errors</a></code></dt>
<dd>
<div class="desc"><p>Possible errors raised by a <code><a title="just_jobs.Manager" href="#just_jobs.Manager">Manager</a></code> during use.</p></div>
</dd>
<dt><code class="name"><a title="just_jobs.manager" href="manager.html">just_jobs.manager</a></code></dt>
<dd>
<div class="desc"><p>The entrypoint for all job queueing and brokering within an application.</p></div>
</dd>
</dl>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="just_jobs.Manager"><code class="flex name class">
<span>class <span class="ident">Manager</span></span>
<span>(</span><span>broker: Type[<a title="just_jobs.brokers.base.Broker" href="brokers/base.html#just_jobs.brokers.base.Broker">Broker</a>] = just_jobs.brokers.redis.RedisBroker, queue_names: Optional[List[str]] = None, **bkwargs)</span>
</code></dt>
<dd>
<div class="desc"><p>The entrypoint for all job queueing and brokering within an application.</p></div>
<h3>Instance variables</h3>
<dl>
<dt id="just_jobs.Manager.queue_names"><code class="name">var <span class="ident">queue_names</span></code></dt>
<dd>
<div class="desc"><p>The queue names to which jobs will be placed.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>It is <em><strong>highly</strong></em> recommended to set this list of queue names to logically
/ functionally separate action-flows in your application. This is because
jobs in a single queue are processed sequentially (albeit in
asyncio-parallel). Defining separate queues for unrelated actions ensures
that a job in one queue does not block the unrelated job from executing.</p>
</div></div>
</dd>
<dt id="just_jobs.Manager.broker"><code class="name">var <span class="ident">broker</span></code></dt>
<dd>
<div class="desc"><p>The broker class to instantiate. <code><a title="just_jobs.RedisBroker" href="#just_jobs.RedisBroker">RedisBroker</a></code> by default, but may be
replaced with a custom <code><a title="just_jobs.Broker" href="#just_jobs.Broker">Broker</a></code> if desired.</p></div>
</dd>
<dt id="just_jobs.Manager.bkwargs"><code class="name">var <span class="ident">bkwargs</span></code></dt>
<dd>
<div class="desc"><p>Any keyword arguments to pass to the <code>broker</code> during initialization.</p></div>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="just_jobs.Manager.startup"><code class="name flex">
<span>async def <span class="ident">startup</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Startup the broker to allow it to perform any initial actions, like connecting
to a database. Also spawn/fork the processing queues and register them
with the manager, to allow for graceful cleanup during shutdown.</p></div>
</dd>
<dt id="just_jobs.Manager.shutdown"><code class="name flex">
<span>async def <span class="ident">shutdown</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Signal all processing workers to shutdown and wait for them to cleanup. Also
gracefully shutdown the broker. This must be called after startup.</p></div>
</dd>
<dt id="just_jobs.Manager.enqueue"><code class="name flex">
<span>async def <span class="ident">enqueue</span></span>(<span>self, func: Callable, *args, queue_name: str = 'default', **kwargs)</span>
</code></dt>
<dd>
<div class="desc"><p>Enqueues the given function and its arguments for asynchronous execution
sometime in the near future. All functions are wrapped and serialized. No
guarantee is given for WHEN an enqueued job will be run, only that it will
(or at least, attempted). The time until execution will depend on the number
of enqueued tasks, their complexities, and the rest of the workload present on
the system.</p></div>
</dd>
</dl>
</dd>
<dt id="just_jobs.Broker"><code class="flex name class">
<span>class <span class="ident">Broker</span></span>
<span>(</span><span>coroutines_per_worker: int = 20)</span>
</code></dt>
<dd>
<div class="desc"><p>An abtract Broker interface used to define custom functionality. Every Broker
class must inherit from this interface and override the defined abstract methods.</p></div>
<h3>Ancestors</h3>
<ul class="hlist">
<li>abc.ABC</li>
</ul>
<h3>Subclasses</h3>
<ul class="hlist">
<li><a title="just_jobs.brokers.redis.RedisBroker" href="brokers/redis.html#just_jobs.brokers.redis.RedisBroker">RedisBroker</a></li>
</ul>
<h3>Instance variables</h3>
<dl>
<dt id="just_jobs.Broker.coroutines_per_worker"><code class="name">var <span class="ident">coroutines_per_worker</span></code></dt>
<dd>
<div class="desc"><p>The number of coroutine working tasks to spawn per queue. Each coroutine
processes and runs jobs atomically, and their parallelism is handeled by
asyncio. Defaults to 20.</p></div>
</dd>
<dt id="just_jobs.Broker.is_worker"><code class="name">var <span class="ident">is_worker</span></code></dt>
<dd>
<div class="desc"><p>Set by the <code><a title="just_jobs.Manager" href="#just_jobs.Manager">Manager</a></code> to mark this broker as a worker responsible for processing
jobs. May be used during startup and shutdown to do worker-specific actions.</p></div>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="just_jobs.Broker.startup"><code class="name flex">
<span>async def <span class="ident">startup</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Performs any setup required by the storage broker, like connecting to a
database.</p></div>
</dd>
<dt id="just_jobs.Broker.shutdown"><code class="name flex">
<span>async def <span class="ident">shutdown</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Performs any shutdown required by the broker, like ensuring disconnection from
a database.</p></div>
</dd>
<dt id="just_jobs.Broker.enqueue"><code class="name flex">
<span>async def <span class="ident">enqueue</span></span>(<span>self, queue_name: str, job: bytes)</span>
</code></dt>
<dd>
<div class="desc"><p>Enqueues the given serialized job to the provided queue for later processing.</p></div>
</dd>
<dt id="just_jobs.Broker.process_jobs"><code class="name flex">
<span>async def <span class="ident">process_jobs</span></span>(<span>self, queue_name: str)</span>
</code></dt>
<dd>
<div class="desc"><p>Infinitly polls for new jobs pushed the given queue and attempts to run them
via <code><a title="just_jobs.Broker.run_job" href="#just_jobs.Broker.run_job">Broker.run_job()</a></code>. Jobs must be dequeued atomically. This method is also
responsible for determining what to do if a job fails, like re-adding it to
the queue.</p>
<p>~ See <code><a title="just_jobs.RedisBroker.process_jobs" href="brokers/base.html#just_jobs.brokers.base.Broker.process_jobs">RedisBroker.process_jobs()</a></code> for an example.</p></div>
</dd>
<dt id="just_jobs.Broker.run_job"><code class="name flex">
<span>async def <span class="ident">run_job</span></span>(<span>self, job: bytes) ‑> bool</span>
</code></dt>
<dd>
<div class="desc"><p>Loads and executes a job, either directly in the event loop if it's a
coroutine or in a threadpool if it isn't. Returns if the job ran successfully
or not.</p></div>
</dd>
</dl>
</dd>
<dt id="just_jobs.RedisBroker"><code class="flex name class">
<span>class <span class="ident">RedisBroker</span></span>
<span>(</span><span>shutdown_with_pool: bool = True, url: Optional[str] = None, connection_pool: Optional[aioredis.connection.ConnectionPool] = None, **kwargs)</span>
</code></dt>
<dd>
<div class="desc"><p>Production-ready job broker using <a href="https://github.com/aio-libs/aioredis">aioredis</a>
for queue management and job persistence.</p></div>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="just_jobs.brokers.base.Broker" href="brokers/base.html#just_jobs.brokers.base.Broker">Broker</a></li>
<li>abc.ABC</li>
</ul>
<h3>Instance variables</h3>
<dl>
<dt id="just_jobs.RedisBroker.url"><code class="name">var <span class="ident">url</span></code></dt>
<dd>
<div class="desc"><p>A valid fully-qualified URL to a Redis instance. See <a href="https://aioredis.readthedocs.io/en/latest/api/high-level/#aioredis.client.Redis.from_url"><code>Redis.from_url</code></a> from <a href="https://github.com/aio-libs/aioredis-py">aioredis</a> for more information. Mutually exclusive with <code>connection_pool</code>.</p></div>
</dd>
<dt id="just_jobs.RedisBroker.connection_pool"><code class="name">var <span class="ident">connection_pool</span></code></dt>
<dd>
<div class="desc"><p>A valid connection pool to a Redis instance. See <a href="https://aioredis.readthedocs.io/en/latest/examples/#connection-pooling">aioredis.ConnectionPool</a> for more information.</p></div>
</dd>
<dt id="just_jobs.RedisBroker.shutdown_with_pool"><code class="name">var <span class="ident">shutdown_with_pool</span></code></dt>
<dd>
<div class="desc"><p>Indicates that the connection pool should release all connections and
disconnect when the broker is shutdown. Defaults to true.</p></div>
</dd>
<dt id="just_jobs.RedisBroker.kwargs"><code class="name">var <span class="ident">kwargs</span></code></dt>
<dd>
<div class="desc"><p>Any keyword arguments to pass through to the aioredis.Redis instance during
creation.</p></div>
</dd>
</dl>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="just_jobs.brokers.base.Broker" href="brokers/base.html#just_jobs.brokers.base.Broker">Broker</a></b></code>:
<ul class="hlist">
<li><code><a title="just_jobs.brokers.base.Broker.coroutines_per_worker" href="brokers/base.html#just_jobs.brokers.base.Broker.coroutines_per_worker">coroutines_per_worker</a></code></li>
<li><code><a title="just_jobs.brokers.base.Broker.enqueue" href="brokers/base.html#just_jobs.brokers.base.Broker.enqueue">enqueue</a></code></li>
<li><code><a title="just_jobs.brokers.base.Broker.is_worker" href="brokers/base.html#just_jobs.brokers.base.Broker.is_worker">is_worker</a></code></li>
<li><code><a title="just_jobs.brokers.base.Broker.process_jobs" href="brokers/base.html#just_jobs.brokers.base.Broker.process_jobs">process_jobs</a></code></li>
<li><code><a title="just_jobs.brokers.base.Broker.run_job" href="brokers/base.html#just_jobs.brokers.base.Broker.run_job">run_job</a></code></li>
<li><code><a title="just_jobs.brokers.base.Broker.shutdown" href="brokers/base.html#just_jobs.brokers.base.Broker.shutdown">shutdown</a></code></li>
<li><code><a title="just_jobs.brokers.base.Broker.startup" href="brokers/base.html#just_jobs.brokers.base.Broker.startup">startup</a></code></li>
</ul>
</li>
</ul>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<header>
<a class="homelink" rel="home" title="just-jobs Home" href="https://thearchitector.github.io/just-jobs/just_jobs">
<img src="https://thearchitector.github.io/just-jobs/logo.png" alt=""> just-jobs
</a>
</header>
<h1>Index</h1>
<div class="toc">
<ul>
<li><a href="#what-is-a-job">What is a "job"?</a></li>
</ul>
</div>
<ul id="index">
<li><h3><a href="#header-submodules">Sub-modules</a></h3>
<ul>
<li><code><a title="just_jobs.brokers" href="brokers/index.html">just_jobs.brokers</a></code></li>
<li><code><a title="just_jobs.errors" href="errors.html">just_jobs.errors</a></code></li>
<li><code><a title="just_jobs.manager" href="manager.html">just_jobs.manager</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="just_jobs.Manager" href="#just_jobs.Manager">Manager</a></code></h4>
<ul class="two-column">
<li><code><a title="just_jobs.Manager.startup" href="#just_jobs.Manager.startup">startup</a></code></li>
<li><code><a title="just_jobs.Manager.shutdown" href="#just_jobs.Manager.shutdown">shutdown</a></code></li>
<li><code><a title="just_jobs.Manager.enqueue" href="#just_jobs.Manager.enqueue">enqueue</a></code></li>
<li><code><a title="just_jobs.Manager.queue_names" href="#just_jobs.Manager.queue_names">queue_names</a></code></li>
<li><code><a title="just_jobs.Manager.broker" href="#just_jobs.Manager.broker">broker</a></code></li>
<li><code><a title="just_jobs.Manager.bkwargs" href="#just_jobs.Manager.bkwargs">bkwargs</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="just_jobs.Broker" href="#just_jobs.Broker">Broker</a></code></h4>
<ul class="">
<li><code><a title="just_jobs.Broker.startup" href="#just_jobs.Broker.startup">startup</a></code></li>
<li><code><a title="just_jobs.Broker.shutdown" href="#just_jobs.Broker.shutdown">shutdown</a></code></li>
<li><code><a title="just_jobs.Broker.enqueue" href="#just_jobs.Broker.enqueue">enqueue</a></code></li>
<li><code><a title="just_jobs.Broker.process_jobs" href="#just_jobs.Broker.process_jobs">process_jobs</a></code></li>
<li><code><a title="just_jobs.Broker.run_job" href="#just_jobs.Broker.run_job">run_job</a></code></li>
<li><code><a title="just_jobs.Broker.coroutines_per_worker" href="#just_jobs.Broker.coroutines_per_worker">coroutines_per_worker</a></code></li>
<li><code><a title="just_jobs.Broker.is_worker" href="#just_jobs.Broker.is_worker">is_worker</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="just_jobs.RedisBroker" href="#just_jobs.RedisBroker">RedisBroker</a></code></h4>
<ul class="">
<li><code><a title="just_jobs.RedisBroker.url" href="#just_jobs.RedisBroker.url">url</a></code></li>
<li><code><a title="just_jobs.RedisBroker.connection_pool" href="#just_jobs.RedisBroker.connection_pool">connection_pool</a></code></li>
<li><code><a title="just_jobs.RedisBroker.shutdown_with_pool" href="#just_jobs.RedisBroker.shutdown_with_pool">shutdown_with_pool</a></code></li>
<li><code><a title="just_jobs.RedisBroker.kwargs" href="#just_jobs.RedisBroker.kwargs">kwargs</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p><a href="https://ecologi.com/eliasgabriel?r=6128126916bfab8bd051026c"><img alt="Buy a tree" src="https://img.shields.io/badge/Treeware-%F0%9F%8C%B3-lightgreen?style=flat-square"></a></p>
<p><a href="https://www.vecteezy.com">Rake Icon by Vecteezy</a></p>
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>